// 當網頁應用程式被請求時，顯示 index.html 內容
function doGet(e) {
  return HtmlService.createTemplateFromFile('index').evaluate();
}

// 讀取 Google Sheet 中的場館和廳別資料
function getVenueAndHallData() {
  const spreadsheetId = '1lCstMc5vc11FTYm6oCOrGpknSg_K06wBJ9UkwJBGZ80';
  const sheetName = 'DATE';
  const ss = SpreadsheetApp.openById(spreadsheetId);
  const sheet = ss.getSheetByName(sheetName);
  
  if (!sheet) {
    Logger.log(`找不到工作表：${sheetName}`);
    return {};
  }
  
  const data = sheet.getRange(2, 1, sheet.getLastRow() - 1, 2).getValues();
  const result = {};
  
  data.forEach(row => {
    const venue = row[0] ? row[0].toString().trim() : '';
    const hall = row[1] ? row[1].toString().trim() : '';
    if (venue && hall) {
      if (!result[venue]) {
        result[venue] = [];
      }
      result[venue].push(hall);
    }
  });
  return result;
}

// 修正後的函式：讀取產品樣式、價格和照片連結資料
function getProductData() {
  const spreadsheetId = '1lCstMc5vc11FTYm6oCOrGpknSg_K06wBJ9UkwJBGZ80';
  const sheetName = 'DATE';  
  const ss = SpreadsheetApp.openById(spreadsheetId);
  const sheet = ss.getSheetByName(sheetName);
  
  if (!sheet) {
    Logger.log(`找不到工作表：${sheetName}`);
    return {};
  }
  
  // 取得 C2:F 欄的所有資料 (類別、樣式、價格、照片連結)
  const data = sheet.getRange(2, 3, sheet.getLastRow() - 1, 4).getValues();
  const result = {};
  
  data.forEach(row => {
    const category = row[0] ? row[0].toString().trim() : ''; // 產品類別 (C 欄)
    const style = row[1] ? row[1].toString().trim() : '';      // 產品樣式 (D 欄)
    const price = row[2];                                      // 產品單價 (E 欄)
    const photoUrl = row[3] ? row[3].toString().trim() : '';   // 新增：照片連結 (F 欄)
    
    if (category && style) {
      if (!result[category]) {
        result[category] = {};
      }
      // 將樣式物件包含價格和照片連結
      result[category][style] = {
        price: price,
        photoUrl: photoUrl
      };
    }
  });
  return result;
}

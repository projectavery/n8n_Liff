<!DOCTYPE html>
<html>
<head>
    <title>LIFF 取得使用者資訊</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <script charset="utf-8" src="https://static.line-scdn.net/liff/sdk/2.2.0/liff.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
            background-color: #f0f2f5;
            color: #333;
        }
        #profile-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 30px;
            display: inline-block; /* Ensures container only takes necessary width */
            text-align: left;
        }
        #profile-picture {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 2px solid #ddd;
        }
        p {
            margin: 8px 0;
            font-size: 16px;
        }
        strong {
            color: #007bff;
        }
        #status {
            font-size: 18px;
            font-weight: bold;
            color: #555;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>LIFF 使用者資訊</h1>
    <p id="status">正在載入 LIFF...</p>

    <div id="profile-container" style="display: none;">
        <h2>您的 LINE 個人資料</h2>
        <img id="profile-picture" src="" alt="個人頭像">
        <p><strong>顯示名稱:</strong> <span id="display-name"></span></p>
        <p><strong>使用者 ID:</strong> <span id="user-id"></span></p>
        <p><strong>狀態消息:</strong> <span id="status-message"></span></p>
        <p><strong>電子郵件:</strong> <span id="email"></span></p>
    </div>

    <script>
        async function initializeLiff() {
            const liffId = "2007786741-6QMmP4Kg"; // 請替換成您的 LIFF ID

            try {
                await liff.init({ liffId: liffId });
                document.getElementById('status').textContent = 'LIFF 初始化成功！';

                if (liff.isLoggedIn()) {
                    document.getElementById('status').textContent = '正在取得使用者資料...';
                    await getUserProfile();
                } else {
                    document.getElementById('status').textContent = '您尚未登入 LINE。正在導向登入頁面...';
                    liff.login(); // 導向 LINE 登入頁面
                }
            } catch (err) {
                console.error('LIFF 初始化失敗', err);
                document.getElementById('status').textContent = `LIFF 初始化失敗：${err.message}。請確認您的 LIFF ID 是否正確，並在 LINE Developers 後台啟用 Scope。`;
            }
        }

        async function getUserProfile() {
            try {
                // 取得基本個人資料
                const profile = await liff.getProfile();
                document.getElementById('display-name').textContent = profile.displayName;
                document.getElementById('user-id').textContent = profile.userId;
                document.getElementById('profile-picture').src = profile.pictureUrl || 'https://via.placeholder.com/100'; // 如果沒有頭像則顯示預設圖片
                document.getElementById('status-message').textContent = profile.statusMessage || '無狀態消息';

                // 取得電子郵件 (需要 'email' scope)
                if (liff.get, idToken()) { // 檢查是否已取得 ID Token，ID Token 包含電子郵件資訊
                    const decodedIdToken = liff.getDecodedIDToken();
                    document.getElementById('email').textContent = decodedIdToken.email || '無電子郵件 (需要啟用 email scope)';
                } else {
                    document.getElementById('email').textContent = '無電子郵件 (需要啟用 email scope)';
                }

                document.getElementById('profile-container').style.display = 'block';
                document.getElementById('status').style.display = 'none'; // 隱藏狀態訊息
            } catch (err) {
                console.error('取得使用者資料失敗', err);
                document.getElementById('status').textContent = `取得使用者資料失敗：${err.message}。請確認您已在 LINE Developers 後台啟用所需的 Scope (profile, email)。`;
            }
        }

        window.onload = initializeLiff;
    </script>
</body>
</html>
